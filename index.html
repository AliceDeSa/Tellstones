<!-- ================= IN√çCIO DO DOCUMENTO ================= -->
<html lang="pt-BR">

<head>
  <!-- ========== METADADOS E IMPORTS ========== -->
  <meta charset="UTF-8">
  <meta http-equiv="Content-Security-Policy"
    content="default-src *; script-src * 'unsafe-inline' 'unsafe-eval'; style-src * 'unsafe-inline'; img-src * data:;">
  <meta name="viewport" content="width=1024, user-scalable=no">
  <meta name="mobile-web-app-capable" content="yes">
  <title>TellStones</title>
  <link rel="stylesheet" href="assets/css/main.css?v=5.2.0">
  <link rel="icon" type="image/webp" href="assets/img/logo.webp">
  <link rel="stylesheet" href="assets/fonts/fonts.css">

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js')
          .then(req => console.log('Service Worker Registrado!', req))
          .catch(err => console.log('Service Worker Falhou', err));
      });
    }
  </script>
  <!-- Google Analytics (GA4) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-QK5X0YDD54"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-QK5X0YDD54', { 'debug_mode': true });
  </script>
</head>

<body>
  <!-- ================= PARALLAX BACKGROUND (DISABLED) ================= -->
  <!--
  <div id="parallax-container">
    <div class="parallax-layer layer-1" style="background-image: url('assets/img/bg_taverna.png');"></div>
    <div class="parallax-layer layer-2" style="background-image: url('assets/img/bg_plateia.png');"></div>
    <div class="parallax-layer layer-3" style="background-image: url('assets/img/bg_guereira.png');"></div>
    <div class="parallax-layer layer-3b" style="background-image: url('assets/img/bg_genneral.png');"></div>
    <div class="parallax-layer layer-4" style="background-image: url('assets/img/bg_mesa.png');"></div>
    <div class="parallax-overlay"></div>
  </div>
  -->
  <!-- ================= OVERLAY GIRAR TELA ================= -->
  <div id="rotate-device-overlay"
    style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#181c24; z-index:999999; align-items:center; justify-content:center; flex-direction:column; text-align:center; padding:20px;">
    <div style="font-size:4em; color:#ffd700; margin-bottom:20px;">‚Üª</div>
    <h2 style="color:#fff;">Por favor, gire seu dispositivo</h2>
    <p style="font-size: 0.9em; margin: 6px 0;">√öltima Atualiza√ß√£o: 19/01/2026</p>
    <p style="font-size: 0.8em; opacity: 0.8;">v4.5.1 - Action Buttons Fix</p>
    <p style="color:#baecff;">Tellstones foi feito para ser jogado na horizontal.</p>
    <button id="btn-fullscreen-rotate"
      style="margin-top:20px; padding:12px 24px; font-size:1.1em; background:#2d8cff; color:white; border:none; border-radius:8px; cursor:pointer;">
      üîÑ For√ßar Horizontal (Tela Cheia)
    </button>
  </div>

  <!-- ================= PLACAR CENTRAL ================= -->
  <div id="placar-turno-central" style="display:none;"></div>

  <!-- ================= BOT√ÉO DE MUTE GLOBAL ================= -->
  <button id="btn-mute-global" title="Mutar/Desmutar M√∫sica"
    style="position:fixed; top:10px; right: -7px; z-index:100000; background:transparent; border:none; cursor:pointer; color:rgba(255,255,255,0.7); display:flex; align-items:center; justify-content:center; font-size:24px; transition: color 0.3s;"
    onmouseover="this.style.color='rgba(255,255,255,1)'"
    onmouseout="this.style.color='window.isMuted ? \'rgba(255,255,255,0.5)\' : \'rgba(255,255,255,0.7)\''">
    üîä
  </button>

  <!-- ================= TELA INICIAL ================= -->
  <div id="start-screen" class="active">
    <!-- T√≠tulo e slogan -->
    <h1>TellStones</h1>
    <h2 id="slogan-main">Memorize. Blefe. Desafie.</h2>

    <!-- Bot√µes principais -->
    <div id="main-menu-btns" style="display:flex; flex-direction:column; gap:-5px; align-items:center;">
      <button id="tutorial-btn">Tutorial</button>
      <button id="bot-pve-btn">Jogo PvE</button>
      <button id="online-menu-btn">Jogo Online</button>
    </div>

    <!-- Menu Online -->
    <!-- Menu Online (Tabbed Layout) -->
    <div id="online-menu" style="display:none; flex-direction:column; gap:0px; align-items:center;">
      <button id="back-to-main-btn">&#8617;</button>

      <!-- Tabs (Buttons Fixed) -->
      <div id="online-tabs-container" style="display:flex; gap:20px; margin-bottom: 20px;">
        <button id="create-room-btn">Criar Sala</button>
        <button id="join-room-btn">Entrar em Sala</button>
      </div>

      <!-- Content Area -->
      <div id="online-content-area"
        style="width: 100%; display: flex; justify-content: center; height: 280px; align-items: flex-start;">

        <!-- Op√ß√µes para criar sala/lobby -->
        <div id="room-options" style="display:none; flex-direction: column; align-items: center;">
          <h3 style="color:#daa520; font-family:'Cinzel Decorative'; margin-bottom:15px; display:none;">Criar Nova Sala
          </h3>
          <div style="display:flex; gap:20px; margin-bottom:10px;">
            <label>
              <input type="radio" name="mode" value="1x1" checked> 1x1 (Duelo)
            </label>
            <label>
              <input type="radio" name="mode" value="2x2"> 2x2 (Duplas)
            </label>
          </div>
          <input type="text" id="nome-criar" placeholder="Seu apelido" maxlength="20" style="margin:10px 0;width:300px">
          <button id="start-game-btn">Criar Lobby</button>
          <div id="codigo-sala-criada" style="margin-top:10px;color:#8ecfff;font-weight:bold;"></div>
        </div>

        <!-- Op√ß√µes para entrar em sala -->
        <div id="join-room" style="display:none; flex-direction: column; align-items: center;">
          <h3 style="color:#00ffff; font-family:'Cinzel Decorative'; margin-bottom:15px; display:none;">Entrar na Sala
          </h3>
          <input type="text" id="nome-entrar" placeholder="Seu apelido" maxlength="20"
            style="margin-bottom:8px;width:300px">
          <input type="text" id="room-code" placeholder="C√≥digo da sala" maxlength="8"
            style="margin-bottom:8px;width:300px">
          <div style="display:flex; gap:20px; margin: 5px 0 15px 0;">
            <label style="color:#f1f1f1;">
              <input type="radio" name="tipo-entrada" value="jogador" checked> Jogador
            </label>
            <label style="color:#f1f1f1;">
              <input type="radio" name="tipo-entrada" value="espectador"> Espectador
            </label>
          </div>
          <button id="enter-room-btn">Entrar</button>
        </div>

      </div>
    </div>

  </div>

  <div id="changelog-box"></div>


  <!-- ================= LOBBY ================= -->
  <div id="lobby">
    <button id="back-from-lobby-btn" title="Voltar"
      style="position:absolute; top:20px; right:20px; background:transparent; border:none; cursor:pointer; color:#fff; font-size:24px; padding:0;">
      &#8617;
    </button>
    <h2>Lobby da Partida</h2>
    <div id="lobby-codigo" style="margin-bottom:10px;"></div>
    <div>
      <strong>Jogadores:</strong>
      <ul id="lobby-jogadores"></ul>
    </div>
    <div>
      <strong>Espectadores:</strong>
      <ul id="lobby-espectadores"></ul>
    </div>
    <button id="lobby-iniciar" style="display:none;margin-top:20px;">Iniciar Jogo</button>
  </div>

  <!-- ================= TELA DE JOGO ================= -->
  <div id="game">
    <!-- ======= INFORMA√á√ïES DA SALA E ESPECTADORES ======= -->
    <div id="info-sala">
      <div id="codigo-sala">C√≥digo: <span id="codigo-sala-valor"></span></div>
      <div id="espectadores">Espectadores: <span id="lista-espectadores"></span></div>
    </div>
    <!-- ======= BOT√ïES DE A√á√ïES LATERAIS RESTORED TO GAME ======= -->
    <div id="botoes-acoes-laterais">
      <button id="btn-desafiar">Desafiar</button>
      <button id="btn-segabar">Se Gabar</button>
    </div>
    <!-- ======= √çCONE DE A√á√ïES ======= -->
    <!-- √çcone de a√ß√µes removido daqui e movido para o body para corrigir z-index -->
    <!-- ======= CARD DE A√á√ïES ======= -->
    <div id="box-acoes" style="display:none;">
      <h3>A√ß√µes Poss√≠veis</h3>
      <ul>
        <li><strong>Colocar:</strong> Adiciona pedra √† mesa.</li>
        <li><strong>Esconder:</strong> Vira uma pedra para baixo.</li>
        <li><strong>Mover:</strong> Muda posi√ß√£o de uma pedra.</li>
        <li><strong>Trocar:</strong> Troca duas pedras de lugar.</li>
        <li><strong>Espiar:</strong> Olha uma pedra virada.</li>
        <li><strong>Desafiar:</strong> Testa o oponente sobre uma pedra virada.</li>
        <li><strong>Se Gabar:</strong> Afirma saber todas as posi√ß√µes.<br>
          <small>O oponente pode responder:<br>
            <b>1. Acreditar:</b> O jogador que fez a a√ß√£o ganha 1 ponto.<br>
            <b>2. Duvidar:</b> O jogador deve provar que sabe a combina√ß√£o das pe√ßas.<br>
            &nbsp;&nbsp;&nbsp;&nbsp;Se conseguir, vence o jogo imediatamente.<br>
            &nbsp;&nbsp;&nbsp;&nbsp;Se errar qualquer pedra, o oponente vence.<br>
            <b>3. Se gabar:</b> O oponente diz que tamb√©m sabe onde est√£o todas as pe√ßas.<br>
            &nbsp;&nbsp;&nbsp;&nbsp;Se conseguir, vence o jogo imediatamente.<br>
            &nbsp;&nbsp;&nbsp;&nbsp;Se errar qualquer pedra, o oponente vence.
          </small>
        </li>
      </ul>
    </div>
    <!-- ======= TABULEIRO CENTRAL ======= -->
    <div id="tabuleiro-center">
      <div id="linha-vertical-pedras"></div>
      <div id="circle-pedras">
        <!-- pedras renderizadas via JS -->
      </div>
      <div id="tabuleiro-wrapper" style="width:740px;height:320px;position:relative;display:inline-block;">
        <img id="tabuleiro" src="assets/img/Tabuleiro.jpg" alt="Tabuleiro Tellstones"
          style="width:740px;height:320px;object-fit:contain;" />
        <div id="pedras-mesa"></div>
        <!-- Marcadores de ponto √† esquerda (Jogador 1 ou Dupla 1) -->
        <div class="marcador-ponto marcador-esquerda" data-idx="0"></div>
        <div class="marcador-ponto marcador-esquerda" data-idx="1"></div>
        <div class="marcador-ponto marcador-esquerda" data-idx="2"></div>
        <!-- Marcadores de ponto √† direita (Jogador 2 ou Dupla 2) -->
        <div class="marcador-ponto marcador-direita" data-idx="0"></div>
        <div class="marcador-ponto marcador-direita" data-idx="1"></div>
        <div class="marcador-ponto marcador-direita" data-idx="2"></div>
        <div id="info-sala-local" style="position: absolute; top: 10px; right: 10px; z-index: 100;">
          <button id="btn-sair-partida"
            style="background:#f44336; color:white; border:none; border-radius:4px; padding:8px 12px; cursor:pointer; font-weight:bold; box-shadow: 0 2px 5px rgba(0,0,0,0.3);">Sair
            da Partida</button>
        </div>
        <!-- Bot√£o e anima√ß√£o da moeda -->
        <button id="moeda-btn" title="Lan√ßar moeda"
          style="background:none;border:none;outline:none;position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);z-index:20;width:auto;height:auto;display:none;">
          <span id="moeda-animada"
            style="display:inline-block;width:80px;height:80px;position:relative;perspective:300px;">
            <img id="moeda-frente" src="assets/img/Cara.png"
              style="width:100%;height:100%;border-radius:50%;object-fit:cover;object-position:50% 52%;position:absolute;left:0;top:0;backface-visibility:hidden;transition:transform 0.6s;box-shadow:0 2px 8px #0007;background:#222;" />
            <img id="moeda-verso" src="assets/img/Coroa.png"
              style="width:100%;height:100%;border-radius:50%;object-fit:cover;object-position:50% 52%;position:absolute;left:0;top:0;backface-visibility:hidden;transform:rotateY(180deg);transition:transform 0.6s;box-shadow:0 2px 8px #0007;background:#222;" />
          </span>
        </button>
        <audio id="som-moeda" src="assets/audio/moeda.mp3" preload="auto"></audio>
        <!-- Bot√µes laterais removidos daqui -->
      </div>
      <div id="pedra-central-animada" style="display:none;"></div>
    </div>
  </div>

  <!-- ================= √çCONE DE A√á√ïES (GLOBAL) ================= -->
  <!-- Movido para fora de #game para garantir z-index superior ao card -->
  <div id="icone-acoes" title="A√ß√µes"
    style="padding:0;width:60px;height:60px;display:none;align-items:center;justify-content:center;background:none;border:none;">
    <img src="assets/img/A√ß√µes.png" alt="A√ß√µes" style="width:54px;height:54px;object-fit:contain;display:block;" />
  </div>

  <!-- ================= CARTA DE A√á√ïES ================= -->
  <div id="carta-acoes" style="display:none;">
    <img src="assets/img/ad5d0fc0-caaf-424b-b71c-4334c8e62921.png" alt="Carta de A√ß√µes" id="img-carta-acoes" />
    <div id="conteudo-acoes">
      <!-- As a√ß√µes ser√£o renderizadas aqui via JS -->
    </div>
  </div>

  <!-- ================= TOASTS E CR√âDITOS ================= -->
  <div id="toast-interno"></div>
  <div id="toast" style="display:none"></div>

  <!-- ================= ESCOLHA CARA OU COROA ================= -->
  <div id="escolha-cara-coroa"
    style="display:none; position:fixed; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.7); z-index:4000; align-items:center; justify-content:center;">
    <div
      style="background:#222; padding:32px 40px; border-radius:16px; box-shadow:0 4px 32px #000a; text-align:center;">
      <h2>Escolha: Cara ou Coroa ?</h2>
      <button id="btn-cara"
        style="margin:12px 24px; font-size:1.2em; display:inline-flex; flex-direction:column; align-items:center;">
        <img src="assets/img/Cara.png" alt="Cara"
          style="width:48px;height:48px;border-radius:50%;margin-bottom:6px;box-shadow:0 2px 8px #0007;" />
        Cara
      </button>
      <button id="btn-coroa"
        style="margin:12px 24px; font-size:1.2em; display:inline-flex; flex-direction:column; align-items:center;">
        <img src="assets/img/Coroa.png" alt="Coroa"
          style="width:48px;height:48px;border-radius:50%;margin-bottom:6px;box-shadow:0 2px 8px #0007;" />
        Coroa
      </button>
    </div>
  </div>

  <!-- ================= TELA DE VIT√ìRIA/DERROTA ================= -->
  <div id="tela-vitoria"
    style="display:none; position:fixed; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.85); z-index:99999; align-items:center; justify-content:center; flex-direction:column;">
    <div id="tela-vitoria-conteudo"
      style="background:#232942; color:#fff; padding:48px 60px; border-radius:18px; box-shadow:0 4px 32px #000a; text-align:center; max-width:90vw;">
      <h2 id="tela-vitoria-titulo">Vit√≥ria!</h2>
      <p id="tela-vitoria-msg">Parab√©ns, voc√™ venceu!</p>
      <button id="btn-voltar-lobby"
        style="margin-top:32px; font-size:1.1em; padding:12px 32px; border-radius:8px; background:#2d8cff; color:#fff; border:none; cursor:pointer;">Voltar
        ao Lobby</button>
    </div>
  </div>

  <!-- ================= SCRIPTS E √ÅUDIO ================= -->
  <div id="audio-container" style="display:none;">
    <audio id="som-fundo" src="assets/audio/ambient.mp3" loop preload="auto"></audio>
    <audio id="som-click" src="assets/audio/click.wav" preload="auto"></audio>
    <audio id="som-press" src="assets/audio/press.mp3" preload="auto"></audio>
    <audio id="som-desafio" src="assets/audio/som%20teste.wav" preload="auto"></audio>
    <audio id="som-sucesso" src="assets/audio/success%20minimalistic.wav" preload="auto"></audio>
    <audio id="som-falha" src="assets/audio/failure.wav" preload="auto"></audio>
  </div>
  <!-- Script principal do jogo -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <script src="src/core/constants.js"></script>
  <script src="src/utils/Logger.js"></script>
  <script src="src/utils/utils.js"></script>
  <script src="src/config/firebase-config.js"></script>
  <script src="src/services/network.js"></script>
  <script src="src/core/GameRules.js"></script>
  <script src="src/config/GameConfig.js"></script>
  <script src="src/ui/AnimationManager.js"></script>
  <script src="src/ui/effects/Confetti.js?v=5.0.1"></script>
  <script src="src/ui/Renderer.js"></script>
  <script src="src/ui/ChangelogManager.js"></script>
  <script src="src/core/InputHandler.js"></script>
  <script src="src/core/AnalyticsManager.js"></script>
  <script src="src/core/RoomManager.js?v=5.0.1"></script>
  <script src="src/core/GameController.js"></script>
  <script src="src/ui/MouseTrail.js"></script>
  <script src="src/utils/AudioManager.js?v=5.0.1"></script>
  <script src="src/ui/NotificationManager.js"></script>

  <!-- AI -->
  <script src="src/ai/BotBrain.js"></script>

  <!-- Game Modes -->
  <script src="src/modes/GameMode.js?v=v4_alpha_1"></script>
  <script src="src/modes/MultiplayerMode.js?v=v4_alpha_1"></script>
  <script src="src/modes/PvEMode.js?v=v4_alpha_1"></script>
  <script src="src/modes/TellstonesTutorial.js"></script>
  <script src="src/modes/TutorialMode.js?v=v4_alpha_1"></script>

  <script src="src/main.js?v=5.0.1"></script>

  <!-- Debug / Automation -->
  <script src="src/debug/TutorialAutomator.js"></script>
  <script src="src/debug/PvEAutomator.js"></script>
  <!-- Dev Tools (Restricted) -->
  <div id="dev-tools-container" style="display:none;">
    <button id="btn-dev-automator" onclick="if(window.TutorialAutomator) window.TutorialAutomator.run()"
      style="position:fixed; bottom:10px; right:120px; z-index:999999; background:#4caf50; color:white; border:none; padding:8px 12px; border-radius:4px; font-size:12px; cursor:pointer; opacity:0.7;">
      üêû Test Tutorial
    </button>
    <button id="btn-dev-pve" onclick="if(window.PvEAutomator) window.PvEAutomator.run()"
      style="position:fixed; bottom:10px; right:10px; z-index:999999; background:#ff9800; color:white; border:none; padding:8px 12px; border-radius:4px; font-size:12px; cursor:pointer; opacity:0.7;">
      ü§ñ Test PvE Link
    </button>
    <button id="btn-dev-bot-profile"
      style="position:fixed; bottom:50px; right:10px; z-index:999999; background:#9c27b0; color:white; border:none; padding:8px 12px; border-radius:4px; font-size:12px; cursor:pointer; opacity:0.7;">
      üß† Bot: Random
    </button>
  </div>
  <script>
    (function () {
      const params = new URLSearchParams(window.location.search);
      // Ativa se tiver ?dev=true na URL ou se j√° estiver salvo no LocalStorage
      if (params.has('dev')) {
        localStorage.setItem('tellstones_dev_mode', 'true');
      }
      if (params.has('nodev')) {
        localStorage.removeItem('tellstones_dev_mode');
      }

      if (localStorage.getItem('tellstones_dev_mode') === 'true') {
        const devContainer = document.getElementById('dev-tools-container');
        if (devContainer) devContainer.style.display = 'block';

        // Bot Profile cycler
        const profiles = ['logical', 'trickster', 'aggressive', 'random'];
        let currentIdx = 3; // Start at random
        const btn = document.getElementById('btn-dev-bot-profile');
        btn.onclick = function () {
          currentIdx = (currentIdx + 1) % profiles.length;
          const next = profiles[currentIdx];
          btn.innerText = `üß† Bot: ${next.charAt(0).toUpperCase() + next.slice(1)}`;
          localStorage.setItem('tellstones_dev_bot_profile', next);

          // Apply if game is running
          if (window.currentGameMode && window.currentGameMode.setBotProfile) {
            window.currentGameMode.setBotProfile(next);
          }
        };

        // Initialize button text from LocalStorage
        const saved = localStorage.getItem('tellstones_dev_bot_profile');
        if (saved && profiles.includes(saved)) {
          currentIdx = profiles.indexOf(saved);
          btn.innerText = `üß† Bot: ${saved.charAt(0).toUpperCase() + saved.slice(1)}`;
        }
      }
    })();
  </script>

  <!-- ================= KO-FI WIDGET ================= -->
  <script src="https://storage.ko-fi.com/cdn/scripts/overlay-widget.js"></script>
  <script>
    if (window.kofiWidgetOverlay && !document.getElementById('kofi-widget-overlay')) {
      kofiWidgetOverlay.draw('alicedesa', {
        'type': 'floating-chat',
        'floating-chat.donateButton.text': '',
        'floating-chat.donateButton.background-color': '#794bc4',
        'floating-chat.donateButton.text-color': '#fff'
      });
    }
  </script>

  <!-- ================= BOT√ïES DE A√á√ïES LATERAIS REMOVED FROM BODY ================= -->

  <!-- ================= TOOLTIP GLOBAL ================= -->
  <div id="tooltip"
    style="display:none;position:fixed;z-index:99999;padding:8px 14px;background:rgba(24,28,36,0.98);color:#ffd700;border-radius:8px;font-size:1em;box-shadow:0 2px 8px #000a;pointer-events:none;white-space:nowrap;">
  </div>

</body>

</html>