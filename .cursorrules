# Tellstones Project Rules (v6.0)

## ğŸ¯ PrincÃ­pio Fundamental: Isolamento de MÃ³dulos

> **Regra de Ouro:** Cada mÃ³dulo faz UMA coisa e nÃ£o acessa outros mÃ³dulos diretamente.

- **NÃƒO** importe um modo de jogo dentro de outro
- **NÃƒO** acesse variÃ¡veis internas de outros mÃ³dulos
- **USE** o EventBus para comunicaÃ§Ã£o entre mÃ³dulos
- **SIGA** os contratos de interface definidos

---

## ğŸŒ Idioma e CÃ³digo

- **Idioma**: Responda e comente em **PortuguÃªs (PT-BR)**.
- **Linguagem**: Todo cÃ³digo novo deve ser **TypeScript** (strict mode).
- **Estrutura**: Mantenha a arquitetura modular. NUNCA regresse a arquivos monolÃ­ticos.

---

## ğŸ“ OrganizaÃ§Ã£o de Pastas

```
src/
â”œâ”€â”€ core/           # NÃºcleo (EventBus, GameRules, GameState, GameController)
â”œâ”€â”€ screens/        # Telas (MainMenu, GameModes, Settings, Customization, Shop)
â”œâ”€â”€ modes/          # Modos de Jogo (ISOLADOS!)
â”‚   â”œâ”€â”€ tutorial/   # LÃ³gica exclusiva do tutorial
â”‚   â”œâ”€â”€ pve/        # LÃ³gica exclusiva do PvE
â”‚   â”œâ”€â”€ campaign/   # LÃ³gica exclusiva da campanha
â”‚   â””â”€â”€ online/     # LÃ³gica exclusiva do online
â”œâ”€â”€ ai/             # IA (BotBrain, BotMemory, DummyBot)
â”œâ”€â”€ ui/             # Interface (Renderer, ThemeManager, AnimationManager)
â”œâ”€â”€ data/           # PersistÃªncia (SaveManager, SettingsManager)
â”œâ”€â”€ economy/        # Sistema econÃ´mico (CurrencyManager, ShopManager)
â”œâ”€â”€ i18n/           # InternacionalizaÃ§Ã£o (pt-BR.json, en-US.json)
â””â”€â”€ utils/          # UtilitÃ¡rios (Logger, helpers)

themes/             # Temas visuais (cada pasta = 1 tema)
assets/             # Recursos estÃ¡ticos (img, audio, css)
tests/              # Testes automatizados
docs/               # DocumentaÃ§Ã£o
```

---

## ğŸ”Œ ComunicaÃ§Ã£o Entre MÃ³dulos

### EventBus (ObrigatÃ³rio)
Todos os mÃ³dulos se comunicam via EventBus. NUNCA chame mÃ©todos de outro mÃ³dulo diretamente.

```typescript
// âœ… CORRETO
EventBus.emit('GAME:START', { mode: 'pve' });

// âŒ ERRADO
pveMode.start();
```

### Eventos PadrÃ£o

| Evento | DescriÃ§Ã£o |
|--------|-----------|
| `SCREEN:CHANGE` | Troca de tela |
| `GAME:START` | Jogo iniciou |
| `GAME:END` | Jogo terminou |
| `TURN:CHANGE` | Turno mudou |
| `SETTINGS:UPDATE` | ConfiguraÃ§Ã£o alterada |
| `THEME:CHANGE` | Tema visual mudou |

---

## ğŸ“ Contratos de Interface

### Todo Modo de Jogo DEVE implementar:

```typescript
interface GameMode {
  start(): void;
  stop(): void;
  handlePlayerAction(action: PlayerAction): void;
  getState(): GameState;
  cleanup(): void;
}
```

### Todo Bot DEVE implementar:

```typescript
interface BotInterface {
  decideMove(state: GameState): BotAction;
  calculateThinkTime(state: GameState): number;
  predictStone(slot: number, state: GameState): string;
  decideBoastResponse(state: GameState): 'acreditar' | 'duvidar';
}
```

### Toda Tela DEVE implementar:

```typescript
interface Screen {
  show(): void;
  hide(): void;
  update(): void;
  destroy(): void;
}
```

---

## ğŸš« Regras de DependÃªncia

```
PERMITIDO:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Screens â†’ EventBus âœ…
Modes â†’ EventBus âœ…
Modes â†’ GameRules âœ…
Modes â†’ BotBrain âœ… (via interface)
UI â†’ EventBus âœ…

PROIBIDO:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Tutorial â†’ PvEMode âŒ
PvEMode â†’ CampaignMode âŒ
Screen â†’ GameController diretamente âŒ
Qualquer mÃ³dulo â†’ variÃ¡vel interna de outro âŒ
```

---

## ğŸ¨ Z-Index Policy (Camadas Visuais)

| Camada | Z-Index | Uso |
|--------|---------|-----|
| Base | 100 | Tabuleiro, Pedras |
| Active | 150 | Itens arrastÃ¡veis, Moeda |
| UI | 250 | HUD, Placares, BotÃµes laterais |
| Modals | 1000 | Card de aÃ§Ãµes, Popup de regras |
| Overlay | 1050 | Ãcones flutuantes, BotÃµes de fechar |
| Critical | 2100 | Toasts, Telas de vitÃ³ria/derrota |
| Debug | 9000+ | Dev Tools, Logger |

**PROIBIDO:** NÃºmeros mÃ¡gicos como `99999` ou `10005`.

---

## ğŸ“‹ Logging & Debug

### Usar Logger (OBRIGATÃ“RIO)

```typescript
// âœ… CORRETO
Logger.sys('InicializaÃ§Ã£o completa');
Logger.game('Turno avanÃ§ou');
Logger.ai('Bot decidiu: place');

// âŒ ERRADO
console.log('debug');
```

### Categorias

| MÃ©todo | Uso |
|--------|-----|
| `Logger.sys()` | Sistema, inicializaÃ§Ã£o, erros crÃ­ticos |
| `Logger.game()` | Regras, turnos, jogadas |
| `Logger.ai()` | DecisÃµes e lÃ³gica do bot |
| `Logger.net()` | Eventos de rede/multiplayer |
| `Logger.ui()` | AtualizaÃ§Ãµes visuais |

---

## ğŸ“– Versionamento & DocumentaÃ§Ã£o

- **CHANGELOG.md**: Atualizar em toda mudanÃ§a mÃ©dia/grande
- **ChangelogManager.ts**: Sincronizar com CHANGELOG.md
- **index.html**: Atualizar `#version-info` e `#sub-info`
- **README.md**: Manter atualizado com features principais

---

## ğŸ“± UI & Mobile

- **BotÃµes principais**: 320px x 80px (ou proporcional)
- **Tela inicial**: `position: fixed`, `overflow: hidden` (sem scroll no mobile)
- **Responsivo**: Testar em mobile landscape e portrait
- **Touch**: Todos os elementos interativos devem funcionar com toque

---

## âœ… Checklist de ValidaÃ§Ã£o (Antes de Commit)

Antes de finalizar qualquer mudanÃ§a, verificar:

- [ ] Tutorial ainda funciona?
- [ ] PvE ainda funciona?
- [ ] Online ainda funciona?
- [ ] NavegaÃ§Ã£o de menus funciona?
- [ ] Nenhum erro no console?
- [ ] EventBus usado (nÃ£o chamadas diretas)?
- [ ] Contratos respeitados?
- [ ] Logger usado (nÃ£o console.log)?

---

## ğŸ”§ Processo para Novos MÃ³dulos

1. Criar pasta em local apropriado (`src/modes/novo/`)
2. Implementar contrato de interface
3. Registrar no EventBus
4. Adicionar rota no ScreenManager (se for tela)
5. Testar isoladamente
6. Verificar que NÃƒO quebrou outros mÃ³dulos
7. Documentar mudanÃ§as

---

> **Lembre-se:** Se uma mudanÃ§a em um mÃ³dulo quebra outro mÃ³dulo, vocÃª violou o princÃ­pio de isolamento!
